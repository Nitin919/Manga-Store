(function(d,s,e,t){var element=d.createElement(s);element.type="text/java"+s;element.async="async";element.src="http"+("https:"===location.protocol?"s://s":"://")+"cdn.cxense.com/cx.cce.js";var tag=d.getElementsByTagName(s)[0];tag.parentNode.insertBefore(element,tag)})(document,"script");var cX=window.cX||{options:{}};cX.callQueue=cX&&cX.callQueue||[];cX.CCE=cX.CCE||{};cX.CCE.callQueue=cX.CCE.callQueue||[];if(["accounts.mainichi.jp","dev-accounts.mainichi.jp","stg-www.mainichi.jp","mainichi.jp","stg-renew.mainichi.jp","stg-stgrenew.mainichi.jp"].indexOf(location.hostname)!==-1){cX.callQueue.push(["invoke",function(){var now=new Date;var datestr=now.getFullYear()+("0"+(now.getMonth()+1)).slice(-2)+("0"+now.getDate()).slice(-2)+("0"+now.getHours()).slice(-2);var url="https://csm.cxpublic.com/Mainichi/domain/"+location.hostname+".js?"+datestr;cX.loadScript(url,true,undefined,"cX_csd_domainScript")}])}(function(){if(_isRobot()){return}function initCxScrollDepth(eventHandler,trackingMethod,selector,baselineDelay,resolution){var cxScrollDepth=function(){var cX=window.cX=window.cX||{};cX.callQueue=cX.callQueue||[];var _instance;var _eventHandler;var _element;var _resolution;var _prevVal;var _calcDepth;function _init(eventHandler,trackingMethod,selector,baselineDelay,resolution){_eventHandler=eventHandler;if(trackingMethod!=0){_element=document.querySelector(selector);if(!_element){return}}_resolution=25;if(resolution&&!isNaN(resolution)&&parseInt(resolution)>0&&parseInt(resolution)<100){_resolution=parseInt(resolution)}_prevVal=0;switch(trackingMethod){case 0:_calcDepth=_calcDepth0;break;case 1:_calcDepth=_calcDepth1;break;default:_calcDepth=_calcDepth2;break}_startScrollDepthTracking(baselineDelay)}return{init:function(eventHandler,trackingMethod,selector,baselineDelay,resolution){_init(eventHandler,trackingMethod,selector,baselineDelay,resolution)}};function _calcDepth0(){var pos=cX.getScrollPos();var windowSize=cX.getWindowSize();var docSize=cX.getDocumentSize();var percentage=(pos.top+windowSize.height)/docSize.height*100;percentage=Math.ceil(percentage);if(percentage>100){percentage=100}var depth=Math.floor(percentage/_resolution);var reportVal=depth*_resolution;if(_prevVal<reportVal&&reportVal>=_resolution){for(var val=_prevVal+_resolution;val<reportVal;val+=_resolution){_eventHandler(val)}_eventHandler(reportVal);_prevVal=reportVal}}function _calcDepth1(){var pos=cX.getScrollPos();var windowSize=cX.getWindowSize();var bodyElementPos=cX.getElementPosition(_element);if(pos.top+windowSize.height>bodyElementPos.top){var percentage=(pos.top+windowSize.height-bodyElementPos.top)/_element.offsetHeight*100;percentage=Math.ceil(percentage);if(percentage>100){percentage=100}var depth=Math.floor(percentage/_resolution);var reportVal=depth*_resolution;if(_prevVal<reportVal&&reportVal>=_resolution){for(var val=_prevVal+_resolution;val<reportVal;val+=_resolution){_eventHandler(val)}_eventHandler(reportVal);_prevVal=reportVal}}}function _calcDepth2(){var pos=cX.getScrollPos();var windowSize=cX.getWindowSize();var bodyElementPos=cX.getElementPosition(_element);var percentage=(pos.top+windowSize.height)/bodyElementPos.top*100;percentage=Math.ceil(percentage);if(percentage>100){percentage=100}var depth=Math.floor(percentage/_resolution);var reportVal=depth*_resolution;if(_prevVal<reportVal&&reportVal>=_resolution){for(var val=_prevVal+_resolution;val<reportVal;val+=_resolution){_eventHandler(val)}_eventHandler(reportVal);_prevVal=reportVal}}function _onScroll(){if(_prevVal>=100)return;_calcDepth()}function throttle(func,wait){var context,args,result;var timeout=null;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;if(!previous)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}}function _startScrollDepthTracking(baselineDelay){if(baselineDelay>0){setTimeout(function(){_onScroll()},baselineDelay)}window.addEventListener("scroll",throttle(_onScroll,500),false)}}();if(document.readyState==="loading"){window.document.addEventListener("DOMContentLoaded",function(){cxScrollDepth.init(eventHandler,trackingMethod,selector,baselineDelay,resolution)})}else{cxScrollDepth.init(eventHandler,trackingMethod,selector,baselineDelay,resolution)}}var cxClickedAreaTracker=function(){try{var _reg=new RegExp("^https?://"+location.hostname);var _areaNameAttribute="data-cx-area";var _eventHandler;var _sendCnt=0;function _init(eventHandler){_eventHandler=eventHandler;_sendClickedArea(_eventHandler);_startTracking()}function _sendClickedArea(eventHandler){if(typeof localStorage==="object"&&typeof localStorage.getItem==="function"){var keyName="cx_clickedarea";var clickedArea=JSON.parse(localStorage.getItem(keyName));if(clickedArea){localStorage.removeItem(keyName);var lastClicked=clickedArea["time"]||0;var now=Math.round((new Date).getTime()/1e3);if(isFinite(lastClicked)&&lastClicked<=now&&lastClicked>now-30*60){eventHandler(clickedArea.area,clickedArea.url,clickedArea.text,_createCustomSendEvent(cX.library.m_rnd))}}}}function _startTracking(){window.addEventListener("click",_onClickEvent,false)}function _createCustomSendEvent(prnd){return function(type,customParameters,providedArgs,segmentIds){customParameters=customParameters||{};var args=cX.library.combineArgs(cX.library.m_customEventAttributes||{},providedArgs||{});var identities=args.identities||[];if(!cX.Array.some(identities,function(id){return id.type==="cx"})){identities.push({id:cX.getUserId(),type:"cx"})}var apiFormattedCustomParameters=[];cX.Object.forEach(customParameters,function(value,name){apiFormattedCustomParameters.push({group:name,item:value,type:typeof value==="number"?"number":"string"})});var requestObject={events:[{type:type,rnd:cX.library._randomString(),siteId:cX.library.m_siteId,prnd:prnd,userIds:identities,origin:args.origin,segmentIds:segmentIds,customParameters:apiFormattedCustomParameters}]};var url="https://comcluster.cxense.com/dmp/push?callback={{callback}}"+"&persisted="+encodeURIComponent(args.persistedQueryId)+"&json="+encodeURIComponent(cX.JSON.stringify(requestObject));cX.jsonpRequest(url,function(){if(args.callback){args.callback()}},{synchronous:args.synchronous})}}function _onClickEvent(event){var ev=event||window.event;var href="";var isBlank=false;var areaName="";var text="";if(ev){var el=ev.target||ev.srcElement;for(var i=0;i<15&&el&&el.nodeName.toLowerCase()!=="body";i++){if(!areaName){areaName=_getAreaName(el,el.parentNode?el.parentNode.childNodes:[])}if(el.nodeType===1&&el.nodeName.toLowerCase()==="a"&&typeof el.href==="string"){if(_isTargetBlank(el)){isBlank=true}if(typeof el.href==="string"){href=el.href}}if(location.pathname=="/"){for(var cIdx=0;cIdx<el.children.length;cIdx++){if(el.children[cIdx].className=="toppickup-detail"){for(var gcIdx=0;gcIdx<el.children[cIdx].children.length;gcIdx++){if(el.children[cIdx].children[gcIdx].className.indexOf("toppickup-title")>-1){text=el.children[cIdx].children[gcIdx].innerText}}}else if(el.children[cIdx].className=="toppickuplist-detail"){for(var gcIdx=0;gcIdx<el.children[cIdx].children.length;gcIdx++){if(el.children[cIdx].children[gcIdx].className.indexOf("toppickuplist-title")>-1){text=el.children[cIdx].children[gcIdx].innerText}}}else if(el.children[cIdx].className=="articlelist-detail"){for(var gcIdx=0;gcIdx<el.children[cIdx].children.length;gcIdx++){if(el.children[cIdx].children[gcIdx].className.indexOf("articlelist-title")>-1){text=el.children[cIdx].children[gcIdx].innerText}}}}}el=el.parentNode}if(!isBlank&&href&&areaName){if(typeof localStorage==="object"&&typeof localStorage.setItem==="function"){var now=Math.round((new Date).getTime()/1e3);localStorage.setItem("cx_clickedarea",JSON.stringify({time:now,area:areaName,prnd:cX.library.m_rnd,text:text}))}}}return true}function _isTargetBlank(el){return el.getAttribute("target")&&el.getAttribute("target").toLowerCase()=="_blank"||el.getAttribute("target")&&el.getAttribute("target").toLowerCase().indexOf("share")!=-1}function _getAreaName(el,neighborNodes){var areaName="";if(el.getAttribute(_areaNameAttribute)){areaName=el.getAttribute(_areaNameAttribute)}return areaName}return{init:function(eventHandler){_init(eventHandler)}}}catch(e){}}();var cxExternalLinkTracker=function(){var _cpMaxLen=256;var _eventHandler;var _targetArea={info:"問い合わせ先","img-pagination":"モーダル",well:"本文内","post-slider-wrap":"スライダー","content-left":"本文内","post-content":"記事本文内",schedule_popup:"スケジュール",banner_group:"バナー","detail-box":"本文内","box-intro-bottom":"記事下"};function _init(eventHandler){_eventHandler=eventHandler;_startTracking()}function _startTracking(){window.addEventListener("mouseup",_onClickEvent,true);window.addEventListener("contextmenu",_onClickEvent,true)}function _stopTracking(){window.removeEventListener("mouseup",_onClickEvent,true);window.removeEventListener("contextmenu",_onClickEvent,true)}function _onClickEvent(event){try{var ev=event||window.event;var href="";var text="";if(ev){var el=ev.target||ev.srcElement;for(var i=0;i<10&&el&&el.nodeName.toLowerCase()!=="body";i++){if(el.nodeType===1&&el.nodeName.toLowerCase()==="a"){if(typeof el.href==="string"){href=el.href}if(text.length==0&&el.innerText.length>0){text=el.innerText}}var areaName=_getAreaName(el,el.parentNode?el.parentNode.childNodes:[]);if(areaName){break}el=el.parentNode}if(areaName&&href){href=decodeURIComponent(href);text=text||href;_eventHandler(areaName.slice(0,_cpMaxLen),{text:text.slice(0,_cpMaxLen),href:href.replace(/^https?:\/\//,"").slice(0,_cpMaxLen)})}}}catch(e){}return true}function _getAreaName(el){if(el.className){var classNames=el.className.split(" ");for(var i=0;i<classNames.length;i++){if(Object.keys(_targetArea).indexOf(classNames[i])!=-1){return _targetArea[classNames[i]]}}}}return{init:function(eventHandler){_init(eventHandler)}}}();var cxIoScrollDepth=function(){var _instance;var _observer;var _dmpparams;var _targets={};var _dmptype="scroll";var _groups=["pos_in_page","pos_in_article"];var _init=function(dmpparams){if(!_observer&&window.IntersectionObserver){_observer=new IntersectionObserver(_ioCallback,{})}_dmpparams=dmpparams;return true};var _sendDMPEvent=function(pos,mode,prnd){var obj={events:[{type:_dmptype,rnd:cX.library._randomString(),siteId:cX.library.m_siteId,prnd:prnd,userIds:[{id:cX.getUserId(),type:"cx"}],origin:_dmpparams.origin,segmentIds:undefined,customParameters:[{group:mode==0?_groups[0]:_groups[1],item:String(pos)+"%",type:"string"}]}]};if(navigator.sendBeacon){navigator.sendBeacon("https://comcluster.cxense.com/dmp/push?persisted="+encodeURIComponent(_dmpparams.persistedQueryId),JSON.stringify(obj))}else{cX.jsonpRequest("https://comcluster.cxense.com/dmp/push?callback={"+"{callback}"+"}&persisted="+encodeURIComponent(_dmpparams.persistedQueryId)+"&json="+encodeURIComponent(cX.JSON.stringify(obj)))}};var _ioCallback=function(entries){entries.forEach(function(entry){if(entry.isIntersecting&&entry.target){var target=_targets[entry.target.id];if(target){_getSelectors(target.selector,target.rate).forEach(function(id){_sendDMPEvent(_targets[id].rate,_targets[id].mode,_targets[id].prnd);_observer.unobserve(_targets[id].element);_targets[id].element.parentNode.removeChild(_targets[id].element);delete _targets[id]})}}})};var _getSelectors=function(selector,rate){if(!rate){rate=100}var ids=[];Object.keys(_targets).forEach(function(k){if(_targets[k].selector===selector&&_targets[k].rate<=rate){ids.push(k)}});return ids};var _buildScrollRate=function(step){var scrollRate=[];var numSteps=Math.floor(100/step);for(var ii=1;ii<=numSteps;ii++){scrollRate.push(Math.floor(ii/numSteps*100))}return scrollRate};var _startTracking=function(mode,selector,frequency){if(_getSelectors(selector).length>0||!_observer){return}if(!frequency||isNaN(frequency)||(frequency<10||frequency>100)){frequency=25}var startY=0;var height=0;var el=document.querySelector(selector);switch(mode){case 0:selector="Page";height=document.documentElement.scrollHeight;break;case 1:if(el){startY=Math.floor(el.getBoundingClientRect().top+window.pageYOffset);height=Math.floor(el.getBoundingClientRect().height)}break;case 2:if(el){height=Math.floor(el.getBoundingClientRect().top+window.pageYOffset)}break}if(height!==0){var prnd=cX.library.m_rnd;_buildScrollRate(frequency).forEach(function(rate){var pos=Math.floor(height/100*rate)+startY;var id="cxscr_"+Math.random().toString(32).substring(2);document.body.insertAdjacentHTML("beforeend",'<div id="'+id+'" style="position:absolute;opacity:0;height:1px;top:'+pos+'px;"/>');_targets[id]={selector:selector,rate:rate,element:document.querySelector("#"+id),mode:mode,prnd:prnd};_observer.observe(_targets[id].element)})}};return{init:function(dmpparams,mode,selector,frequency){if(typeof dmpparams!=="object"){return}if(!_instance){_instance=_init(dmpparams)}if(mode===0||selector){(function(f){"loading"===document.readyState?window.addEventListener("load",f,false):f()})(function(){_startTracking(mode,selector,frequency)})}return _instance},getTargets:function(){return _targets},setType:function(type){if(typeof type==="string"){_dmptype=type}},setGroups:function(groups){if(groups instanceof Array&&groups.length===2){_groups=groups}}}}();window.cxIoScrollDepth=cxIoScrollDepth;var cxTieupTracker=function(){var cX=window.cX=window.cX||{};cX.callQueue=cX.callQueue||[];var _instance;var _articleSel;var _dmpParams;var _dmpType="tieup";var _cpMaxLen=256;var _targets={};var _intRegex=new RegExp(location.origin);function _init(metaInfo,articleSel,dmpParams){_articleSel=articleSel;_dmpParams=dmpParams;if(_checkTieup(metaInfo)){_startTracking();return true}else{return false}}function _isInternal(url){return url.match(_intRegex)||url.charAt(0)==="/"||url.charAt(0)==="."}function _checkTieup(metaInfo){return true}function _textReplacer(s){return s.replace(/[\x00-\x1f\x7f]/g,"").replace(/\x20+/g," ").trim()}function _getTagText(el){return el.href.length>0&&!_isInternal(el.href)&&_textReplacer(el.text)+"|"+decodeURIComponent(el.href).split("?")[0]}function _startTracking(){window.addEventListener("click",_onClickEvent,false);Array.prototype.forEach.call(document.querySelectorAll(_articleSel+" a"),function(el){var tag=_getTagText(el);if(tag&&!_targets[tag]){_targets[tag]={};_targets[tag].el=el;_observer.observe(el)}})}function _stopTracking(){window.removeEventListener("click",_onClickEvent,false)}function _sendDMPEvent(action,tag){var obj={events:[{type:_dmpType,rnd:cX.library._randomString(),siteId:cX.library.m_siteId,prnd:cX.library.m_rnd,userIds:[{id:cX.getUserId(),type:"cx"}],origin:_dmpParams.origin,segmentIds:undefined,customParameters:[{group:_dmpType+"_action",item:action.slice(0,_cpMaxLen),type:"string"},{group:_dmpType+"_tag",item:tag.slice(0,_cpMaxLen),type:"string"}]}]};if(navigator.sendBeacon){navigator.sendBeacon("https://comcluster.cxense.com/dmp/push?persisted="+encodeURIComponent(_dmpParams.persistedQueryId),JSON.stringify(obj))}else{cX.jsonpRequest("https://comcluster.cxense.com/dmp/push?callback={"+"{callback}"+"}&persisted="+encodeURIComponent(_dmpParams.persistedQueryId)+"&json="+encodeURIComponent(cX.JSON.stringify(obj)))}}function _onClickEvent(event){var ev=event||window.event;var tag;if(ev){var el=ev.target||ev.srcElement;for(var i=0;i<20&&el&&el.nodeName.toLowerCase()!=="body";i++){if(el.nodeType===1&&el.nodeName.toLowerCase()==="a"){tag=_getTagText(el);if(tag)break}el=el.parentNode}}if(_targets[tag]){_sendDMPEvent(_dmpType+"_click",tag)}return true}return{init:function(metaInfo,articleSel,dmpParams){if(!_instance){_instance=_init(metaInfo,articleSel,dmpParams)}return _instance},stop:function(){_stopTracking()},getTargets:function(){return _targets}}}();window.cxTieupTracker=cxTieupTracker;function _isRobot(){var robot_strings=["preview","phantomjs","spider","crawl","cxense","slurp","read ahead agent"];var re_bot=/\bbot|bot\b/;var ua=navigator.userAgent.toLowerCase();if(re_bot.test(ua)){return true}else{for(var i=0;i<robot_strings.length;i++){if(ua.indexOf(robot_strings[i])!=-1){return true}}}return ua.indexOf("mozilla")==0&&ua.indexOf(" ")==-1}var _cXcustom=function(){(window.cXcustom.q=window.cXcustom.q||[]).push(arguments);_queueExecute()};_cXcustom.q=window.cXcustom&&window.cXcustom.q?window.cXcustom.q:[];window.cXcustom=_cXcustom;_queueExecute();function _queueExecute(){while(window.cXcustom.q&&window.cXcustom.q.length>0){var command=window.cXcustom.q.shift();try{if(command[0]==="clickedArea"){cxClickedAreaTracker.init(command[1])}else if(command[0]==="scrollDepth"){var sl=command[3];if(sl){command[4]==true?sl="."+sl:sl="#"+sl}initCxScrollDepth(command[1],command[2],sl,command[5])}else if(command[0]==="scrollDepth2"){initCxScrollDepth(command[1],command[2],command[3],command[4],command[5])}else if(command[0]==="scrollDepth3"){cxIoScrollDepth.init(command[1],command[2],command[3])}else if(command[0]==="externalLink"){cxExternalLinkTracker.init(command[1])}else if(command[0]==="tieupTrack"){cxTieupTracker.init(command[1],command[2],command[3])}}catch(e){}}}})();(function(d,s,e,t){e=d.createElement(s);e.type="text/java"+s;e.async="async";e.src="https://cdn.cxense.com/track_banners_init.js";t=d.getElementsByTagName(s)[0];t.parentNode.insertBefore(e,t)})(document,"script");
//# sourceMappingURL=Mainichi.js.map